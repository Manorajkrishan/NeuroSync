<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroSync - Your AI Companion</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>
<body>
    <div class="companion-container">
        <!-- Header with Avatar -->
        <div class="companion-header">
            <div class="header-left">
                <div class="avatar-wrapper">
                    <div id="companionAvatar" class="companion-avatar neutral" title="Your AI Companion">
                        <div class="avatar-emoji">üë∂</div>
                        <div class="avatar-pulse"></div>
                    </div>
                    <div class="status-indicator">
                        <span id="statusDot" class="status-dot offline"></span>
                        <span id="statusText" class="status-text">Connecting...</span>
                    </div>
                </div>
                <div class="header-info">
                    <h1>NeuroSync</h1>
                    <p class="subtitle" id="companionSubtitle">Your AI Companion</p>
                </div>
            </div>
            <div class="header-actions">
                <a href="/dashboard.html" class="icon-btn dashboard-btn" title="Open Human OS Dashboard" style="text-decoration: none; color: inherit; padding: 8px 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; margin-right: 8px; display: inline-flex; align-items: center; gap: 6px;">
                    üß† Dashboard
                </a>
                <button class="icon-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
            </div>
        </div>

        <!-- Chat Messages Area -->
        <div id="chatMessages" class="chat-messages">
            <div class="welcome-message">
                <div class="message-avatar">üë∂</div>
                <div class="message-bubble ai-message">
                    <div class="message-text">Hi! I'm your AI companion. I'm here to understand how you feel and support you. How are you doing today?</div>
                    <div class="message-time">Just now</div>
                </div>
            </div>
        </div>

        <!-- Quick Emotion Buttons (Contextual) -->
        <div id="quickEmotions" class="quick-emotions" style="display: none;">
            <button class="emotion-quick-btn" data-emotion="happy">üòä Happy</button>
            <button class="emotion-quick-btn" data-emotion="sad">üò¢ Sad</button>
            <button class="emotion-quick-btn" data-emotion="anxious">üò∞ Anxious</button>
            <button class="emotion-quick-btn" data-emotion="calm">üòå Calm</button>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <div class="input-wrapper">
                <textarea 
                    id="messageInput" 
                    class="message-input" 
                    placeholder="How are you feeling today?" 
                    rows="1"></textarea>
                <div class="input-actions">
                    <button class="input-action-btn" id="voiceBtn" title="Record Voice">üé§</button>
                    <button class="input-action-btn" id="sendBtn" title="Send">‚û§</button>
                </div>
            </div>
            <div id="recordingStatus" class="recording-status" style="display: none;">
                <span class="recording-indicator">‚óè</span>
                <span>Recording... Click to stop</span>
            </div>
        </div>

        <!-- Sidebar (Settings, Advanced Features) -->
        <div id="sidebar" class="sidebar" style="display: none;">
            <div class="sidebar-header">
                <h3>Settings</h3>
                <button class="close-btn" id="closeSidebarBtn">‚úï</button>
            </div>
            <div class="sidebar-content">
                <!-- TTS Toggle -->
                <div class="sidebar-section">
                    <label class="toggle-label">
                        <input type="checkbox" id="ttsToggle">
                        <span>Text-to-Speech</span>
                        <span id="ttsStatus" class="toggle-status">Off</span>
                    </label>
                </div>

                <!-- Voice Cloning -->
                <div class="sidebar-section">
                    <h4>üé≠ Voice Cloning</h4>
                    <input type="text" id="voiceClonePersonName" placeholder="Person's name" class="sidebar-input">
                    <input type="file" id="voiceCloneFile" accept="audio/*" style="display: none;">
                    <button class="sidebar-btn" id="uploadVoiceBtn">Upload Voice Sample</button>
                    <div id="voiceCloneStatus" class="sidebar-status"></div>
                </div>

                <!-- Consent Settings -->
                <div class="sidebar-section">
                    <h4>üîí Privacy & Consent</h4>
                    <label class="toggle-label">
                        <input type="checkbox" id="consentEmotionSensing">
                        <span>Emotion Sensing</span>
                    </label>
                    <label class="toggle-label">
                        <input type="checkbox" id="consentVisualLayer">
                        <span>Visual Layer (Camera)</span>
                    </label>
                    <label class="toggle-label">
                        <input type="checkbox" id="consentAudioLayer">
                        <span>Audio Layer</span>
                    </label>
                </div>

                <!-- Voice Notes -->
                <div class="sidebar-section">
                    <h4>üé§ Voice Notes</h4>
                    <div id="voiceNotesList" class="voice-notes-list"></div>
                </div>
            </div>
        </div>

        <!-- Camera Overlay -->
        <div id="cameraOverlay" class="camera-overlay" style="display: none;">
            <div class="camera-container">
                <div class="camera-header">
                    <h3>Facial Expression Detection</h3>
                    <button class="close-btn" id="closeCameraBtn">‚úï</button>
                </div>
                <video id="videoElement" autoplay playsinline></video>
                <canvas id="canvasElement" style="display: none;"></canvas>
                <div id="facialEmotionDisplay" class="facial-emotion-display" style="display: none;">
                    <div class="facial-emotion-badge" id="facialEmotionBadge"></div>
                    <div class="facial-confidence" id="facialConfidence"></div>
                </div>
                <button id="startCameraBtn" class="camera-btn">üì∑ Start Detection</button>
                <button id="stopCameraBtn" class="camera-btn stop-btn" style="display: none;">‚èπÔ∏è Stop</button>
            </div>
        </div>

        <!-- Overlay (for sidebar/camera) -->
        <div id="overlay" class="overlay" style="display: none;"></div>

        <!-- Always-on Corner Camera Widget -->
        <div id="cornerCamera" class="corner-camera">
            <div class="corner-camera-header">
                <span class="corner-camera-title">üì∑ Live Emotion</span>
                <button class="corner-camera-toggle" id="cornerCameraToggle" title="Toggle Camera">üëÅÔ∏è</button>
            </div>
            <div class="corner-camera-content">
                <video id="cornerVideoElement" autoplay playsinline muted></video>
                <canvas id="cornerCanvasElement" style="display: none;"></canvas>
                <div id="cornerEmotionDisplay" class="corner-emotion-display">
                    <div class="corner-emotion-badge" id="cornerEmotionBadge">Neutral</div>
                    <div class="corner-emotion-confidence" id="cornerEmotionConfidence">--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts - ORDER MATTERS: app.js must load first to define initializeSignalR -->
    <script src="app.js?v=4.0"></script>
    <script src="facial-detection.js?v=1.2"></script>
    <script src="voice-cloning.js?v=1.0"></script>
    <script src="companion-ui.js?v=2.8"></script>
</body>
</html>
